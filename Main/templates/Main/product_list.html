{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos - Portal Web</title>
    <link rel="stylesheet" href="{% static 'Menu/css/menu.css' %}" />
    <style>
      body {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      /* Override menu.css to completely disable hover effects */
      #sidebar {
        position: fixed !important;
        left: 0 !important;
        top: 0 !important;
        height: 100vh !important;
        width: 250px !important;
        background-color: #2a2a2a !important;
        transform: none !important;
        transition: none !important;
      }
      .sidebar-header h2 {
        color: #ff8c00 !important;
      }
      .submenu {
        display: none !important;
      }
      .nav-group:hover .submenu {
        display: none !important;
        max-height: 0 !important;
        opacity: 0 !important;
      }
      #main-content {
        margin-left: 250px !important;
        transition: none !important;
        background-color: #1a1a1a !important;
      }
      /* Disable all hover effects on nav buttons */
      .nav-button, .nav-link {
        transition: none !important;
        opacity: 1 !important;
        visibility: visible !important;
        display: flex !important;
        color: #ffffff !important;
      }
      .nav-button:hover, .nav-link:hover {
        background-color: #3a3a3a !important;
        transform: none !important;
      }
      .nav-button span, .nav-link span {
        opacity: 1 !important;
        visibility: visible !important;
        display: inline !important;
      }
      @media (max-width: 768px) {
        #sidebar {
          transform: none !important;
        }
      }
    </style>
  </head>

  <body>
    <aside id="sidebar" aria-label="Menu lateral de navegação">
      <div class="sidebar-header">
        <h2>Menu</h2>
      </div>

      <nav class="sidebar-nav" aria-label="Menu principal">
        <div class="nav-group">
          <a href="{% url 'Main:upload_file' %}" class="nav-button nav-link">
            <span>Upload de Arquivo</span>
          </a>
        </div>

        <div class="nav-group">
          <a href="{% url 'Main:product_list' %}" class="nav-button nav-link">
            <span>Produtos</span>
          </a>
        </div>

        <div class="nav-group">
          <a href="{% url 'Main:upload_history' %}" class="nav-button nav-link">
            <span>Histórico de Uploads</span>
          </a>
        </div>

        <div class="nav-group">
          <a href="{% url 'Main:logout' %}" class="nav-button nav-link" style="margin-top: 20px; background-color: #ff8c00;">
            <span>Sair</span>
          </a>
        </div>
      </nav>
    </aside>

    <main id="main-content" style="margin-left: 250px;">
      <div style="padding: 30px;">

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
          <h1 style="color: #ffffff; margin: 0;">Produtos Cadastrados</h1>
          <a href="{% url 'Main:upload_file' %}" style="padding: 10px 20px; background-color: #ff8c00; color: #1a1a1a; text-decoration: none; border-radius: 5px; font-weight: 600;">
            + Novo Upload
          </a>
        </div>

        <div style="background: #3a3a3a; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); margin-bottom: 20px;">
          <form method="get" style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: end;">
            <div>
              <label style="display: block; margin-bottom: 5px; color: #ffffff; font-weight: 600;">Buscar</label>
              <input type="text" name="search" value="{{ search_query }}" placeholder="Código, descrição, fornecedor..." style="width: 100%; padding: 10px; border: 2px solid #555555; border-radius: 5px; background-color: #2a2a2a; color: #ffffff;">
            </div>

            <div>
              <label style="display: block; margin-bottom: 5px; color: #ffffff; font-weight: 600;">Lote</label>
              <select name="batch" style="width: 100%; padding: 10px; border: 2px solid #555555; border-radius: 5px; background-color: #2a2a2a; color: #ffffff;">
                <option value="">Todos</option>
                {% for batch in batches %}
                  <option value="{{ batch.batch_code }}" {% if batch_filter == batch.batch_code %}selected{% endif %}>
                    {{ batch.batch_code }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label style="display: block; margin-bottom: 5px; color: #ffffff; font-weight: 600;">Sincronização</label>
              <select name="sync" style="width: 100%; padding: 10px; border: 2px solid #555555; border-radius: 5px; background-color: #2a2a2a; color: #ffffff;">
                <option value="">Todos</option>
                <option value="synced" {% if sync_filter == 'synced' %}selected{% endif %}>Sincronizados</option>
                <option value="pending" {% if sync_filter == 'pending' %}selected{% endif %}>Pendentes</option>
              </select>
            </div>

            <button type="submit" style="padding: 10px 20px; background-color: #ff8c00; color: #1a1a1a; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
              Filtrar
            </button>
          </form>
        </div>

        <div style="background: #2a2a2a; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); overflow: hidden;">
          {% if page_obj %}
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background-color: #3a3a3a; border-bottom: 2px solid #ff8c00;">
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Código</th>
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Descrição</th>
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Preço</th>
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Estoque</th>
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Status</th>
                  <th style="padding: 15px; text-align: left; color: #ff8c00; font-weight: 600;">Ações</th>
                </tr>
              </thead>
              <tbody>
                {% for product in page_obj %}
                <tr style="border-bottom: 1px solid #3a3a3a;">
                  <td style="padding: 15px; color: #ffffff; font-weight: 500;">{{ product.product_code }}</td>
                  <td style="padding: 15px; color: #b0b0b0;">{{ product.description|truncatewords:8 }}</td>
                  <td style="padding: 15px; color: #b0b0b0;">
                    {% if product.sale_price %}R$ {{ product.sale_price }}{% else %}-{% endif %}
                  </td>
                  <td style="padding: 15px; color: #b0b0b0;">{{ product.current_stock }}</td>
                  <td style="padding: 15px;">
                    {% if product.synced_to_protheus %}
                      <span style="padding: 4px 12px; background-color: #84cc16; color: #1a1a1a; border-radius: 12px; font-size: 12px; font-weight: 600;">
                        Sincronizado
                      </span>
                    {% else %}
                      <span style="padding: 4px 12px; background-color: #fbbf24; color: #1a1a1a; border-radius: 12px; font-size: 12px; font-weight: 600;">
                        Pendente
                      </span>
                    {% endif %}
                  </td>
                  <td style="padding: 15px;">
                    <a href="{% url 'Main:product_detail' product.pk %}" style="color: #ff8c00; text-decoration: none; font-weight: 500;">
                      Ver Detalhes
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <div style="padding: 20px; background-color: #3a3a3a; display: flex; justify-content: space-between; align-items: center;">
              <div style="color: #b0b0b0;">
                Mostrando {{ page_obj.start_index }} - {{ page_obj.end_index }} de {{ page_obj.paginator.count }} produtos
              </div>

              <div style="display: flex; gap: 10px;">
                {% if page_obj.has_previous %}
                  <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if batch_filter %}&batch={{ batch_filter }}{% endif %}{% if sync_filter %}&sync={{ sync_filter }}{% endif %}" style="padding: 8px 12px; background-color: #2a2a2a; border: 1px solid #555555; border-radius: 5px; color: #ffffff; text-decoration: none;">
                    Primeira
                  </a>
                  <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if batch_filter %}&batch={{ batch_filter }}{% endif %}{% if sync_filter %}&sync={{ sync_filter }}{% endif %}" style="padding: 8px 12px; background-color: #2a2a2a; border: 1px solid #555555; border-radius: 5px; color: #ffffff; text-decoration: none;">
                    Anterior
                  </a>
                {% endif %}

                <span style="padding: 8px 12px; background-color: #ff8c00; color: #1a1a1a; border-radius: 5px; font-weight: 600;">
                  {{ page_obj.number }}
                </span>

                {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if batch_filter %}&batch={{ batch_filter }}{% endif %}{% if sync_filter %}&sync={{ sync_filter }}{% endif %}" style="padding: 8px 12px; background-color: #2a2a2a; border: 1px solid #555555; border-radius: 5px; color: #ffffff; text-decoration: none;">
                    Próxima
                  </a>
                  <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if batch_filter %}&batch={{ batch_filter }}{% endif %}{% if sync_filter %}&sync={{ sync_filter }}{% endif %}" style="padding: 8px 12px; background-color: #2a2a2a; border: 1px solid #555555; border-radius: 5px; color: #ffffff; text-decoration: none;">
                    Última
                  </a>
                {% endif %}
              </div>
            </div>
          {% else %}
            <p style="padding: 40px; text-align: center; color: #b0b0b0;">Nenhum produto encontrado.</p>
          {% endif %}
        </div>
      </div>
    </main>

    <script src="{% static 'Menu/js/menu.js' %}"></script>
  </body>
</html>
